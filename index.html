<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev Journey App</title>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;300;500;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/jpg" href="images/avatar-normal.jpg">
    <link rel="stylesheet" href="css/desktop.css">
</head>
<body>
    <header>
        <div class="title-container">
            <h1>Karla Navas Dev Journey</h1>
            <input id="searchField" type="text" class="form-search" autocomplete="off" />
        </div>
        <div class="pic-container">
            <div><img src="images/avatar-normal.jpg" /></div>
            <div id="wittyComment" class="witty">hello!</div>
        </div>
    </header>
    <div id="techStack">
        <section>
            <div class="nothingToSeeHere">
                 <div>
                     <img src="images/loading.gif" />
                     ... loading ...
                 </div>
            </div>
        </section>
    </div>

    <script type="text/javascript" src="https://momentjs.com/downloads/moment.js"></script>
    <script type="text/javascript">
        let stackData;
        const techStack = document.getElementById("techStack");

        const buildTechStackTable = (buildData) => {
            if(!buildData){
                return false;
            }

            let html = '';
            const items = buildData.map((ele, i) => {
                const techCardClass = (i + 1) % 2 == 1 ? "tech-card-odd":"tech-card-even";

                const tags = ele.tags.map(tag => {
                    return '<span>' + tag + '</span>';
                });

                const stars = [1, 1, 1, 1, 1].map((number, i) => {
                    if(i + 1 <= ele.stars){
                        return '<i class="fas fa-star"></i>';
                    }
                    else if(i + 1 > ele.stars && i < ele.stars){
                        return '<i class="fas fa-star-half-alt"></i>';
                    }
                    else{
                        return '<i class="far fa-star"></i>';
                    }
                });

                const lastUpdatedWFormat = moment(ele.lastUpdated).format("D/MMM/YY");

                return '<section class="' + techCardClass + '">'
                    + '    <div class="tech-card-wrapper">'
                    + '        <div class="logo">'
                    + '            <i class="' + ele.techIcon + '"></i>'
                    + '        </div>'
                    + '        <div class="info">'
                    + '            <div class="info-title">'
                    + '                <h2>' + ele.techTitle + '</h2>'
                    + '                <div class="tags">'
                    + '                    ' + tags.join('')
                    + '                </div>'
                    + '            </div>'
                    + '            <div class="info-description">'
                    + '                <h3>' + ele.infoDescription.title + '</h3>'
                    + '                <p>' + ele.infoDescription.description + '</p>'
                    + '            </div>'
                    + '        </div>'
                    + '        <div class="rating">'
                    + '            <div class="rating-stars">'
                    + '                ' + stars.join('')
                    + '            </div>'
                    + '            <div class="rating-last">'
                    + '                Last updated<br>'
                    + '                ' + lastUpdatedWFormat
                    + '            </div>'
                    + '        </div>'
                    + '    </div>'
                    + '</section>';
            });

            if(items.length){
                techStack.innerHTML = items.join('');
            }
            else{
                techStack.innerHTML = '<section>'
                    + '<div class="nothingToSeeHere">'
                    + '     <div>'
                    + '         <i class="far fa-sad-cry"></i>'
                    + '         Sorry, I don\'t know about that tech skill yet!'
                    + '     </div>'
                    + '</div>'
                    + '</section>';
            }
        }

        const handleSearch = () => {
            const searchFieldValue = document.getElementById("searchField").value.toLowerCase();
            const fieldSearch = (subject) => {
                return subject.toLowerCase().indexOf(searchFieldValue) != -1;
            };

            const searchResuls = stackData.filter((item) => {
                const foundInTitle = fieldSearch(item.techTitle);
                const foundInTags = item.tags.find(tag => {
                    return fieldSearch(tag);
                });
                const foundInDescTitle = fieldSearch(item.infoDescription.title);
                const foundInDesc = fieldSearch(item.infoDescription.description);

                return foundInTitle || foundInTags || foundInDescTitle || foundInDesc;
            });

            buildTechStackTable(searchResuls);
        };

        document
            .getElementById("searchField")
            .addEventListener("keyup", handleSearch);

        fetch("./data/stack.json")
            .then((response) => {
                response.json().then(data => {
                    stackData = data;
                    buildTechStackTable(stackData);
                });
            });
    </script>
</body>
</html>